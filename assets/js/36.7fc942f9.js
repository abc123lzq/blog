(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{188:function(e,t,r){"use strict";r.r(t);var a=r(0),s=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h2",{attrs:{id:"如何打造高性能小程序门户"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#如何打造高性能小程序门户"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://aotu.io/notes/2020/03/25/high-performance-miniprogram/index.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("如何打造高性能小程序门户"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("京东的小程序团队的打造经验分享")]),e._v(" "),r("h3",{attrs:{id:"小程序性能评分规则"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#小程序性能评分规则"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/audits/performance.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("小程序性能评分规则"),r("OutboundLink")],1)]),e._v(" "),r("h3",{attrs:{id:"小程序体验评分工具（audits-面板"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#小程序体验评分工具（audits-面板"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/audits/audits.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("小程序体验评分工具（Audits 面板"),r("OutboundLink")],1)]),e._v(" "),r("h3",{attrs:{id:"小程序测速系统"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#小程序测速系统"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/performanceReport/",target:"_blank",rel:"noopener noreferrer"}},[e._v("小程序测速系统"),r("OutboundLink")],1)]),e._v(" "),r("h3",{attrs:{id:"tree-shaking-摇掉多余的代码"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#tree-shaking-摇掉多余的代码"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://juejin.im/post/5a4dc842518825698e7279a9",target:"_blank",rel:"noopener noreferrer"}},[e._v("Tree-Shaking 摇掉多余的代码"),r("OutboundLink")],1)]),e._v(" "),r("ol",[r("li",[r("p",[r("a",{attrs:{href:"https://github.com/lin-xi/treeshaking/tree/master/rollup-webpack",target:"_blank",rel:"noopener noreferrer"}},[e._v("Tree-Shaking "),r("OutboundLink")],1)])]),e._v(" "),r("li",[r("p",[r("a",{attrs:{href:"https://github.com/purifycss/purifycss",target:"_blank",rel:"noopener noreferrer"}},[e._v("purifycss 摇css"),r("OutboundLink")],1)])])]),e._v(" "),r("h3",{attrs:{id:"减少代码包中的静态资源文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#减少代码包中的静态资源文件"}},[e._v("#")]),e._v(" 减少代码包中的静态资源文件")]),e._v(" "),r("p",[e._v("小程序代码包最终会经过 GZIP 压缩放在 CDN 上，但 GZIP 压缩对于图片资源来说效果非常低。如 JPG、PNG 等格式文件，本身已经被压缩过了，再使用 GZIP 压缩有可能体积更大，得不偿失。所以，除了部分用于容错的图片必须放在代码包（譬如网络异常提示）之外，建议开发者把图片、视频等静态资源都放在 CDN 上。")]),e._v(" "),r("blockquote",[r("p",[e._v("需要注意，Base64 格式本质上是长字符串，和 CDN 地址比起来也会更占空间。")])]),e._v(" "),r("h3",{attrs:{id:"逻辑后移，精简业务逻辑"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#逻辑后移，精简业务逻辑"}},[e._v("#")]),e._v(" 逻辑后移，精简业务逻辑")]),e._v(" "),r("p",[e._v("复杂的逻辑尽量放后端，前端纯显示")]),e._v(" "),r("h3",{attrs:{id:"分包加载"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#分包加载"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/basic.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("分包加载"),r("OutboundLink")],1)]),e._v(" "),r("h3",{attrs:{id:"部分页面-h5-化"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#部分页面-h5-化"}},[e._v("#")]),e._v(" 部分页面 h5 化")]),e._v(" "),r("p",[e._v("小程序提供了 web-view 组件，支持在小程序环境内访问网页。当实在无法在小程序代码包中腾出多余空间时，可以考虑降级方案 —— 把部分页面 h5 化。")]),e._v(" "),r("blockquote",[r("p",[e._v("小程序和 h5 的通信可以通过 JSSDK 或 postMessage 通道来实现，详见 小程序开发文档"),r("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/component/web-view.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("web-view"),r("OutboundLink")],1),e._v("。")])]),e._v(" "),r("h3",{attrs:{id:"白屏时间过长"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#白屏时间过长"}},[e._v("#")]),e._v(" 白屏时间过长")]),e._v(" "),r("p",[e._v("白屏阶段，是指小程序代码包下载完（也就是启动界面结束）之后，页面完成首屏渲染的这一阶段，也就是 FMP (首次有效绘制)。")]),e._v(" "),r("p",[e._v("FMP 没法用标准化的指标定义，但对于大部分小程序来说，页面首屏展示的内容都需要依赖服务端的接口数据，那么影响白屏加载时间的主要由这两个元素构成：")]),e._v(" "),r("ol",[r("li",[e._v("网络资源加载时间")]),e._v(" "),r("li",[e._v("渲染时间")])]),e._v(" "),r("h3",{attrs:{id:"启用本地缓存"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#启用本地缓存"}},[e._v("#")]),e._v(" 启用本地缓存")]),e._v(" "),r("p",[e._v("小程序提供了读写本地缓存的接口，数据存储在设备硬盘上。由于本地 I/O 读写（毫秒级）会比网络请求（秒级）要快很多，所以在用户访问页面时，可以优先从缓存中取上一次接口调用成功的数据来渲染视图，待网络请求成功后再覆盖最新数据重新渲染。除此之外，缓存数据还可以作为兜底数据，避免出现接口请求失败时页面空窗，一石二鸟。")]),e._v(" "),r("p",[e._v("但并非所有场景都适合缓存策略，譬如对数据即时性要求非常高的场景（如抢购入口）来说，展示老数据可能会引发一些问题。")]),e._v(" "),r("p",[e._v("小程序默认会按照 不同小程序、不同微信用户 这两个维度对缓存空间进行隔离。诸如京喜小程序首页也采用了缓存策略，会进一步按照 数据版本号、用户属性 来对缓存进行再隔离，避免信息误展示。")]),e._v(" "),r("h3",{attrs:{id:"小程序-数据预拉取"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#小程序-数据预拉取"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/ability/pre-fetch.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("小程序-数据预拉取"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("小程序官方为开发者提供了一个在小程序冷启动时提前拉取第三方接口的能力")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/operating-mechanism.html#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%90%AF%E5%8A%A8",target:"_blank",rel:"noopener noreferrer"}},[e._v("冷启动和热启动的定义"),r("OutboundLink")],1)]),e._v(" "),r("h3",{attrs:{id:"跳转时预拉取"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#跳转时预拉取"}},[e._v("#")]),e._v(" 跳转时预拉取")]),e._v(" "),r("p",[e._v("为了尽快获取到服务端数据，比较常见的做法是在页面 onLoad 钩子被触发时发起网络请求，但其实这并不是最快的方式。从发起页面跳转，到下一个页面 onLoad 的过程中，小程序需要完成一些环境初始化及页面实例化的工作，耗时大概为 300 ~ 400 毫秒。")]),e._v(" "),r("p",[e._v("实际上，我们可以在发起跳转前（如 wx.navigateTo 调用前），提前请求下一个页面的主接口并存储在全局 Promise 对象中，待下个页面加载完成后从 Promise 对象中读取数据即可。")]),e._v(" "),r("p",[e._v("这也是双线程模型所带来的优势之一，不同于多页面 web 应用在页面跳转/刷新时就销毁掉 window 对象。")]),e._v(" "),r("h3",{attrs:{id:"小程序-分包预下载"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#小程序-分包预下载"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/preload.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("小程序-分包预下载"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("如果开启了分包加载能力，在用户访问到分包内某个页面时，小程序才会开始下载对应的分包。当处于分包下载阶段时，页面会维持在 “白屏” 的启动态，这用户体验是比较糟糕的。")]),e._v(" "),r("p",[e._v("开发者可以配置进入某个页面时预下载可能会用到的分包，避免在页面切换时僵持在 “白屏” 态。")]),e._v(" "),r("h3",{attrs:{id:"非关键渲染数据延迟请求"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#非关键渲染数据延迟请求"}},[e._v("#")]),e._v(" 非关键渲染数据延迟请求")]),e._v(" "),r("p",[e._v("通过优化关键渲染路径，我们可以显著缩短首次渲染页面的时间。")]),e._v(" "),r("p",[e._v("其中一个思路，从缩短网络请求时延的角度加快首屏渲染完成时间，通过拆分接口的手段来降低主接口的调用时延。")]),e._v(" "),r("blockquote",[r("p",[r("a",{attrs:{href:"https://developers.google.com/web/fundamentals/performance/critical-rendering-path",target:"_blank",rel:"noopener noreferrer"}},[e._v("关键渲染路径（Critical Rendering Path）"),r("OutboundLink")],1),e._v(" 是指在完成首屏渲染的过程中必须发生的事件。")])]),e._v(" "),r("h3",{attrs:{id:"分屏渲染"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#分屏渲染"}},[e._v("#")]),e._v(" 分屏渲染")]),e._v(" "),r("p",[e._v("这也是关键渲染路径优化思路之一，通过延迟非关键元素的渲染时机，为关键渲染路径腾出资源。")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/wxml/IntersectionObserver.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("小程序-IntersectionObserver 对象"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("用于推断某些节点是否可以被用户看见、有多大比例可以被用户看见,当主屏部分(比如上部分渲染完成后，在开始下半部分的赋值渲染)")]),e._v(" "),r("h3",{attrs:{id:"接口聚合，请求合并"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#接口聚合，请求合并"}},[e._v("#")]),e._v(" 接口聚合，请求合并")]),e._v(" "),r("p",[e._v("在小程序中，发起网络请求是通过 "),r("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("wx.request"),r("OutboundLink")],1),e._v(" 这个 API。我们知道，在 web 浏览器中，针对同一域名的 HTTP 并发请求数是有限制的；在小程序中也有类似的限制，但区别在于不是针对域名限制，而是针对 API 调用：")]),e._v(" "),r("ol",[r("li",[r("p",[e._v("wx.request （HTTP 连接）的最大并发限制是 10 个；")])]),e._v(" "),r("li",[r("p",[e._v("wx.connectSocket （WebSocket 连接）的最大并发限制是 5 个；")])])]),e._v(" "),r("p",[e._v("超出并发限制数目的 HTTP 请求将会被阻塞，需要在队列中等待前面的请求完成，从而一定程度上增加了请求时延。")]),e._v(" "),r("p",[r("strong",[e._v("因此，对于职责类似的网络请求，最好采用节流的方式，先在一定时间间隔内收集数据，再合并到一个请求体中发送给服务端。")])]),e._v(" "),r("h3",{attrs:{id:"图片资源优化"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#图片资源优化"}},[e._v("#")]),e._v(" 图片资源优化")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://developers.google.com/speed/webp/",target:"_blank",rel:"noopener noreferrer"}},[e._v("WebP"),r("OutboundLink")],1),e._v(" 是 Google 推出的一种支持有损/无损压缩的图片文件格式，得益于更优的图像数据压缩算法，其与 JPG、PNG 等格式相比，在肉眼无差别的图片质量前提下具有更小的图片体积（据官方说明，WebP 无损压缩体积比 PNG 小 26%，有损压缩体积比 JPEG 小 25-34%）。")]),e._v(" "),r("p",[e._v("这个需要后端去配置使用，如果蹦到后端不愿使用的话，推荐个万能工具"),r("a",{attrs:{href:"https://www.u.tools/",target:"_blank",rel:"noopener noreferrer"}},[e._v("uTools"),r("OutboundLink")],1),e._v("，这样就能轻松自己去压缩图片")]),e._v(" "),r("p",[e._v("小程序的 image 组件 自带 lazy-load 懒加载支持。雪碧图技术（CSS Sprite）。")]),e._v(" "),r("h3",{attrs:{id:"骨架屏"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#骨架屏"}},[e._v("#")]),e._v(" 骨架屏")]),e._v(" "),r("ol",[r("li",[r("p",[e._v("可以从降低网络请求时延、减少关键渲染的节点数这两个角度出发，缩短完成 FMP（首次有效绘制）的时间。")])]),e._v(" "),r("li",[r("p",[e._v("从用户感知的角度优化加载体验。")])])]),e._v(" "),r("blockquote",[r("p",[e._v("由于微信小程序不支持 SSR（服务端渲染），使动态渲染骨架屏的方案难以实现，因此可以通过 WXSS 样式静态渲染的。")])]),e._v(" "),r("div",{staticClass:"language-html extra-class"},[r("pre",{pre:!0,attrs:{class:"language-html"}},[r("code",[r("span",{pre:!0,attrs:{class:"token tag"}},[r("span",{pre:!0,attrs:{class:"token tag"}},[r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("skeleton")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token attr-name"}},[r("span",{pre:!0,attrs:{class:"token namespace"}},[e._v("wx:")]),e._v("if")]),r("span",{pre:!0,attrs:{class:"token attr-value"}},[r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')]),e._v("{{isLoading}}"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v('"')])]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),r("span",{pre:!0,attrs:{class:"token tag"}},[r("span",{pre:!0,attrs:{class:"token tag"}},[r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("</")]),e._v("skeleton")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("\n"),r("span",{pre:!0,attrs:{class:"token tag"}},[r("span",{pre:!0,attrs:{class:"token tag"}},[r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("block")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token attr-name"}},[r("span",{pre:!0,attrs:{class:"token namespace"}},[e._v("wx:")]),e._v("else")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("\n  页面主体\n"),r("span",{pre:!0,attrs:{class:"token tag"}},[r("span",{pre:!0,attrs:{class:"token tag"}},[r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("</")]),e._v("block")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v("\n")])])])])}),[],!1,null,null,null);t.default=s.exports}}]);