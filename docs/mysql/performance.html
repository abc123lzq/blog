<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>高性能mysql | lzq技术分享</title>
    <meta name="description" content="花里胡哨">
    <link rel="icon" href="/blog/22026946.jpg?v=2">
    
    <link rel="preload" href="/blog/assets/css/0.styles.084a55d7.css" as="style"><link rel="preload" href="/blog/assets/js/app.fa8ed7ae.js" as="script"><link rel="preload" href="/blog/assets/js/2.7c68edec.js" as="script"><link rel="preload" href="/blog/assets/js/52.07e72d7a.js" as="script"><link rel="preload" href="/blog/assets/js/3.3e80c302.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.16770a6a.js"><link rel="prefetch" href="/blog/assets/js/11.674a250b.js"><link rel="prefetch" href="/blog/assets/js/12.3e6ee1b0.js"><link rel="prefetch" href="/blog/assets/js/13.bd3fceb7.js"><link rel="prefetch" href="/blog/assets/js/14.ab750cc4.js"><link rel="prefetch" href="/blog/assets/js/15.9492852f.js"><link rel="prefetch" href="/blog/assets/js/16.d29f8fd6.js"><link rel="prefetch" href="/blog/assets/js/17.f021f7c2.js"><link rel="prefetch" href="/blog/assets/js/18.6969e4bc.js"><link rel="prefetch" href="/blog/assets/js/19.60584aac.js"><link rel="prefetch" href="/blog/assets/js/20.32ef31c8.js"><link rel="prefetch" href="/blog/assets/js/21.39bf8ff5.js"><link rel="prefetch" href="/blog/assets/js/22.1dfc164c.js"><link rel="prefetch" href="/blog/assets/js/23.b6ad7e5b.js"><link rel="prefetch" href="/blog/assets/js/24.ad902e5c.js"><link rel="prefetch" href="/blog/assets/js/25.f01e31e9.js"><link rel="prefetch" href="/blog/assets/js/26.7fc40730.js"><link rel="prefetch" href="/blog/assets/js/27.cbb8d9ec.js"><link rel="prefetch" href="/blog/assets/js/28.1773ca99.js"><link rel="prefetch" href="/blog/assets/js/29.2550320d.js"><link rel="prefetch" href="/blog/assets/js/30.db593733.js"><link rel="prefetch" href="/blog/assets/js/31.d1fabe26.js"><link rel="prefetch" href="/blog/assets/js/32.ab7194c4.js"><link rel="prefetch" href="/blog/assets/js/33.4ef9af75.js"><link rel="prefetch" href="/blog/assets/js/34.8003cfdf.js"><link rel="prefetch" href="/blog/assets/js/35.c728ba75.js"><link rel="prefetch" href="/blog/assets/js/36.7fc942f9.js"><link rel="prefetch" href="/blog/assets/js/37.3f44471e.js"><link rel="prefetch" href="/blog/assets/js/38.ea537178.js"><link rel="prefetch" href="/blog/assets/js/39.4b3b3271.js"><link rel="prefetch" href="/blog/assets/js/4.a518768d.js"><link rel="prefetch" href="/blog/assets/js/40.4fc158e5.js"><link rel="prefetch" href="/blog/assets/js/41.1a2514b5.js"><link rel="prefetch" href="/blog/assets/js/42.17576a74.js"><link rel="prefetch" href="/blog/assets/js/43.d1281472.js"><link rel="prefetch" href="/blog/assets/js/44.d9f8a1ee.js"><link rel="prefetch" href="/blog/assets/js/45.996eacd1.js"><link rel="prefetch" href="/blog/assets/js/46.7386b414.js"><link rel="prefetch" href="/blog/assets/js/47.6f6426ab.js"><link rel="prefetch" href="/blog/assets/js/48.04361b67.js"><link rel="prefetch" href="/blog/assets/js/49.6d2224d7.js"><link rel="prefetch" href="/blog/assets/js/5.55eed81d.js"><link rel="prefetch" href="/blog/assets/js/50.980f10c0.js"><link rel="prefetch" href="/blog/assets/js/51.8aca5b36.js"><link rel="prefetch" href="/blog/assets/js/53.5611f640.js"><link rel="prefetch" href="/blog/assets/js/54.1cb60b93.js"><link rel="prefetch" href="/blog/assets/js/55.d6f0dfb7.js"><link rel="prefetch" href="/blog/assets/js/56.7749e315.js"><link rel="prefetch" href="/blog/assets/js/57.1b93a5ed.js"><link rel="prefetch" href="/blog/assets/js/58.86fab9d5.js"><link rel="prefetch" href="/blog/assets/js/59.9e74747c.js"><link rel="prefetch" href="/blog/assets/js/6.ce1be70b.js"><link rel="prefetch" href="/blog/assets/js/60.a1bad91b.js"><link rel="prefetch" href="/blog/assets/js/61.98d14240.js"><link rel="prefetch" href="/blog/assets/js/62.185c0294.js"><link rel="prefetch" href="/blog/assets/js/7.613af01f.js"><link rel="prefetch" href="/blog/assets/js/8.f057675c.js"><link rel="prefetch" href="/blog/assets/js/9.c1fe6da1.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.084a55d7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">lzq技术分享</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/docs/blog/" class="nav-link">起点</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发者管理平台" class="dropdown-title"><span class="title">开发者管理平台</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/docs/framework/yapi/" class="nav-link">YApi接口管理品台</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/framework/registry/" class="nav-link">npm服务</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/framework/proDebug/" class="nav-link">真机调试</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/docs/javaScript/" class="nav-link">javaScript</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/jQuery/" class="nav-link">jQuery</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/ground/" class="nav-link">计算机基础</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/webpack/" class="nav-link">webpack</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/Vue/" class="nav-link">Vue源码解析</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/uniapp/" class="nav-link">uniapp采坑日记</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/React/" class="nav-link">React（生态圈）</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/React2/" class="nav-link">React源码解析（待续）</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/install/" class="nav-link">node(待续）</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><span class="title">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/docs/install/one.html" class="nav-link">java（待续）</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/install/two.html" class="nav-link">spring（待续）</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="存储" class="dropdown-title"><span class="title">存储</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/docs/mysql/" class="nav-link router-link-active">mysql</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/redis/" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/install/two.html" class="nav-link">云数存储（待续）</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/docs/highYield/" class="nav-link">高质文章</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/pitAll/html2canvas.html" class="nav-link">大杂烩</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/pdf/" class="nav-link">为人三会</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/abc123lzq/itdoc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/docs/blog/" class="nav-link">起点</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发者管理平台" class="dropdown-title"><span class="title">开发者管理平台</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/docs/framework/yapi/" class="nav-link">YApi接口管理品台</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/framework/registry/" class="nav-link">npm服务</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/framework/proDebug/" class="nav-link">真机调试</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/docs/javaScript/" class="nav-link">javaScript</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/jQuery/" class="nav-link">jQuery</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/ground/" class="nav-link">计算机基础</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/webpack/" class="nav-link">webpack</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/Vue/" class="nav-link">Vue源码解析</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/uniapp/" class="nav-link">uniapp采坑日记</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/React/" class="nav-link">React（生态圈）</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/React2/" class="nav-link">React源码解析（待续）</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/install/" class="nav-link">node(待续）</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="java" class="dropdown-title"><span class="title">java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/docs/install/one.html" class="nav-link">java（待续）</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/install/two.html" class="nav-link">spring（待续）</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="存储" class="dropdown-title"><span class="title">存储</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/docs/mysql/" class="nav-link router-link-active">mysql</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/redis/" class="nav-link">redis</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/install/two.html" class="nav-link">云数存储（待续）</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/docs/highYield/" class="nav-link">高质文章</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/pitAll/html2canvas.html" class="nav-link">大杂烩</a></li><li class="dropdown-item"><!----> <a href="/blog/docs/pdf/" class="nav-link">为人三会</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/abc123lzq/itdoc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/docs/mysql/" class="sidebar-link">基础</a></li><li><a href="/blog/docs/mysql/advanced.html" class="sidebar-link">进阶</a></li><li><a href="/blog/docs/mysql/performance.html" class="active sidebar-link">高性能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/docs/mysql/performance.html#数据库设计规范" class="sidebar-link">数据库设计规范</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/docs/mysql/performance.html#数据库对象名称" class="sidebar-link">数据库对象名称</a></li><li class="sidebar-sub-header"><a href="/blog/docs/mysql/performance.html#数据库基本设计规范" class="sidebar-link">数据库基本设计规范</a></li><li class="sidebar-sub-header"><a href="/blog/docs/mysql/performance.html#索引设计规范" class="sidebar-link">索引设计规范</a></li><li class="sidebar-sub-header"><a href="/blog/docs/mysql/performance.html#数据库字段设计规范" class="sidebar-link">数据库字段设计规范</a></li><li class="sidebar-sub-header"><a href="/blog/docs/mysql/performance.html#数据库sql开发规范" class="sidebar-link">数据库sql开发规范</a></li><li class="sidebar-sub-header"><a href="/blog/docs/mysql/performance.html#数据库操作行为规范" class="sidebar-link">数据库操作行为规范</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="高性能mysql"><a href="#高性能mysql" class="header-anchor">#</a> 高性能mysql</h1> <h2 id="数据库设计规范"><a href="#数据库设计规范" class="header-anchor">#</a> 数据库设计规范</h2> <h3 id="数据库对象名称"><a href="#数据库对象名称" class="header-anchor">#</a> 数据库对象名称</h3> <ol><li>必须使用 小写字母并用下划线分割 (因为有些系统是严格大小写)</li> <li>禁止使用mysql保留关键字(如：select,from,...)</li> <li>能做到见名识义,并且最好不要超过32个字符(如：lzq_userdb , user_account)</li> <li>临时表必须以tmp为前缀并以日期为后缀</li> <li>备份库、表必须以bak为前缀并以日期为后缀</li> <li>存储相同数据的列名和列类型必须一致(多张表的相同数据类型)</li></ol> <h3 id="数据库基本设计规范"><a href="#数据库基本设计规范" class="header-anchor">#</a> 数据库基本设计规范</h3> <ol><li>所有表必须使用Innodb存储引擎 (5.6以上默认引擎)</li> <li>数据库和表的字符集统一使用utf8(避免产生乱码)</li> <li>所有的表和字段都需要添加注释(使用comment从句添加表和列的备注)</li> <li>从一开始就进行数据字典的维护</li> <li>尽量控制单标数据量的大小，建议控制在500万以内（可以使用历史数据归档，分库分表等手段来控制数据量大小）</li> <li>谨慎使用mysql分区表(物理上是多个文件，而逻辑上为一个表)</li> <li>谨慎选择分区键，跨分区查询效率可能更低</li> <li>建议物理分表的方式管理大数据</li> <li>尽量做到冷热数据分离，减小表的宽度（减小磁盘io,保证热数据的内存命中率，更有效的利用缓存，避免读入无用的冷数据，建议把经常使用列放在一张表中）</li> <li>禁止在表中建立预留字段（难以见名识义，后期修改类型会对表进行锁定这样更亏）</li> <li>禁止在数据库中存储图片、文件等二进制数据（应该存储到服务器上）</li> <li>禁止在线上做数据库压力测试（要测去测试环境）</li> <li>禁止从开发环境、测试环境直连生成环境数据库（容易破坏）</li></ol> <h3 id="索引设计规范"><a href="#索引设计规范" class="header-anchor">#</a> 索引设计规范</h3> <ol><li>限制每张表上的索引数量，建议单张表索引不超过5个（索引可以提高查询效率，但会降低操作性能）</li> <li>每个Innodb表必须有个主键(不使用更新频繁的列作为主键，不使用多列主键，不使用uuid，md5,hash，字符串作为主键)</li> <li>主键建议选择使用自增id</li> <li>常见索引列建议</li></ol> <blockquote><p>SELECT、UPDATAE、DELETE语句的WHERE从句中的列</p> <p>包含在ORDER BY、GROUP BY、DISTINCT中的字段</p> <p>多表JOIN的关联列</p></blockquote> <ol start="5"><li>如何选择索引列的顺序</li></ol> <blockquote><p>区分度最高的列放在联合索引的最左侧</p> <p>尽量把字段长度小的列放在联合索引的最左侧</p> <p>使用最频繁的列放到联合索引的左侧</p></blockquote> <ol start="6"><li>避免建多余和重复索引</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 重复索引</span>
<span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>、<span class="token keyword">index</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> 、 <span class="token keyword">unique</span> <span class="token keyword">index</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>

<span class="token comment">-- 多余</span>
<span class="token comment">-- 联合索引是从左到右所以a多余了</span>
<span class="token keyword">index</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span>、 <span class="token keyword">index</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> 、<span class="token keyword">index</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
</code></pre></div><ol start="7"><li>对于频繁的查询优先考虑使用覆盖索引</li></ol> <blockquote><p>避免Innodb表进行索引的二次查找</p> <p>可以把随机io变为顺序io，加快了查询的效率</p></blockquote> <ol start="8"><li>尽量避免使用外键</li></ol> <blockquote><p>外键可用于保证数据的参照完成性，但建议在业务端实现</p> <p>外键会影响父表和子表的写操作从而降低性能</p></blockquote> <h3 id="数据库字段设计规范"><a href="#数据库字段设计规范" class="header-anchor">#</a> 数据库字段设计规范</h3> <ol><li>优先选择符合存储需要的最小的数据类型</li></ol> <blockquote><p>将字符串转化为数字类型存储</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--字符串是15字节，转化数字是4个字节大大节省了</span>
INET_ATON<span class="token punctuation">(</span><span class="token string">'255.255.255.255'</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">4294967295</span>

<span class="token comment">--取值方法</span>
INET_NTOA<span class="token punctuation">(</span><span class="token number">4294967295</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">'255.255.255.255'</span>
</code></pre></div><blockquote><p>对于非负数数据采用无符号整型进行存储</p> <p>VARCHAR(N)中的N是字符数而不是字节数</p></blockquote> <ol start="2"><li>避免使用TEXT、BLOB数据类型(内存大，还需要二次查询)</li> <li>避免使用ENUM数据类型(必须使用ALTER语句才能修改，还有操作效率低)</li> <li>尽可能把所有列定义为NOT NULL(尽量就行了,索引null列需要额外的空间来保存)</li> <li>不推荐字符串存储时间类型的数据（缺点：无法用日期函数进行计算和比较而却占更多空间，推荐使用DATETIME）</li></ol> <h3 id="数据库sql开发规范"><a href="#数据库sql开发规范" class="header-anchor">#</a> 数据库sql开发规范</h3> <ol><li>建议使用预编译 语句进行数据库操作(只需传参，一次解析多次使用)</li> <li>避免数据类型隐式转换</li></ol> <blockquote><p>可能会导致索引失效</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--字符串转int</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> test3 <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token string">'123'</span> 
</code></pre></div><ol start="3"><li>充分利用表上已存在的索引</li></ol> <blockquote><p>避免使用%号的查询条件，如 a like '%123%'</p> <p>一个slq只能利用到复合索引中的一列进行范围查询</p> <p>使用left join 或 not exists 来优化 not in</p></blockquote> <ol start="4"><li>程序连接不同的数据库要使用不同的账号，禁止垮裤查询(降低耦合度，方便迁移)</li> <li>禁止使用SELECT * 必须使用SELECT &lt;字段列表&gt; 查询</li></ol> <blockquote><p>很多不必要的字段消耗的io和cpu</p> <p>无法使用覆盖索引</p></blockquote> <ol start="6"><li>禁止使用不含字段列表的INSERT 语句</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--最好列出插入的字段名字，以免表机构变更带来的影响</span>
<span class="token keyword">INSERT</span>  <span class="token keyword">INTO</span> t_bank <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">)</span>
</code></pre></div><ol start="7"><li>避免使用子查询，可以吧子查询优化为join 操作</li></ol> <blockquote><p>子查询的记过集无法使用索引</p> <p>子查询会产生临时表，数据量大的话影响效率</p> <p>消耗过多的cpu和io资源</p></blockquote> <ol start="8"><li>避免使用join关联太多表</li></ol> <blockquote><p>每join一个表会多占用一部分内存</p> <p>会产生临时表</p> <p>建议不操作过5个</p></blockquote> <ol start="9"><li>减少同数据库的交互次数</li></ol> <blockquote><p>数据库更适合处理批量操作</p> <p>合并多个相同的操作到一起，可以提高处理效率</p></blockquote> <ol start="10"><li>使用in 代替or</li> <li>禁止使用 order by rand() 进行随机排序(会爆掉...,推荐在程序中获取一个随机数，再去数据库中获取操作)</li> <li>WHERE 从句中禁止对列进行函数转哈和计算</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--会导致无法使用索引</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> test3 <span class="token keyword">WHERE</span> <span class="token keyword">DATE</span> <span class="token punctuation">(</span>testTIME<span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">'20180808'</span><span class="token punctuation">;</span>

<span class="token comment">--推荐</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token keyword">FROM</span> test3 <span class="token keyword">WHERE</span> testTIME<span class="token operator">&gt;=</span><span class="token string">'20180808'</span> <span class="token operator">AND</span> testTIME<span class="token operator">&gt;=</span><span class="token string">'20180809'</span>
</code></pre></div><ol start="13"><li>在明显不会有重复值得时候使用UNION ALL 而不是UNION(UNION会先产生临时表再去去重)</li> <li>拆分复杂的大sql为多个小sql(一个sql只能用一个cpu进行计算，耗时大)</li></ol> <h3 id="数据库操作行为规范"><a href="#数据库操作行为规范" class="header-anchor">#</a> 数据库操作行为规范</h3> <ol><li>超过100万行的批量写操作，要分批多次进行操作</li></ol> <blockquote><p>容易造成主从延迟</p> <p>产生大量的日志</p> <p>避免生成大事务操作</p></blockquote> <ol start="2"><li>对于大表使用pt-online-schema-change工具 来修改表机构</li> <li>禁止为程序使用的还在那个号赋予super权限，只能留给dba来使用</li></ol> <div id="comment"></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/docs/mysql/advanced.html" class="prev">进阶</a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.fa8ed7ae.js" defer></script><script src="/blog/assets/js/2.7c68edec.js" defer></script><script src="/blog/assets/js/52.07e72d7a.js" defer></script><script src="/blog/assets/js/3.3e80c302.js" defer></script>
  </body>
</html>
